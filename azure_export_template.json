{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.13.1.58284",
      "templateHash": "13120038605368246703"
    }
  },
  "parameters": {
    "exportName": {
      "type": "string",
      "defaultValue": "[format('store{0}', uniqueString(resourceGroup().id))]",
      "metadata": {
        "description": "The name of the export"
      }
    },
    "storageAccountSubscription": {
      "type": "string",
      "defaultValue": "[subscription()]",
      "metadata": {
        "Description": "Azure Subscription of the Storage Account"
      }
    },
    "storageAccountResourceGroup": {
      "type": "string",
      "defaultValue": "[resourceGroup()]",
      "metadata": {
        "Description": "Azure Resource Group of the Storage Account"
      }
    }    
  },
  "resources": [
    {
      "type": "Microsoft.CostManagement/exports",
      "apiVersion": "2022-10-01",
      "name": "[parameters('exportName')]",
      "properties": {
          "schedule": {
            "status": "Active",
            "recurrence": "Daily",
            "recurrencePeriod": {
              "from": "2020-06-01T00:00:00Z",
              "to": "2020-10-31T00:00:00Z"
            }
          },
          "format": "Csv",
          "deliveryInfo": {
              "destination": {
                "resourceId": "/subscriptions/{storageAccountSubscription}/resourceGroups/{storageAccountResourceGroup}/providers/Microsoft.Storage/storageAccounts/{yourStorageAccount} ",
                "container": "{yourContainer}",
                "rootFolderPath": "{yourDirectory}"
              }
          },
          "definition": {
              "type": "ActualCost",
              "timeframe": "MonthToDate",
              "dataSet": {
                  "granularity": "Daily"
              }
          }
      }
    }
  ],
  "outputs": {
    "exportName": {
      "type": "string",
      "value": "[parameters('exportName')]"
    },
    "exportId": {
      "type": "string",
      "value": "[resourceId('Microsoft.CostManagement/exports', parameters('exportName'))]"
    },
    "storageAccountSubscription": {
      "type": "string",
      "value": "[parameters('storageAccountSubscription')]"
    }
  }
}
